## Laserfiche Validation Rules Repository

This repository is the single source of truth for all validation rules used across Laserfiche Forms and related SQL-based workflows. It exists to ensure consistency, maintainability, and discoverability of validations used in both front-end form fields and back-end stored procedures.

### What lives here
- **Regex rules**: canonical patterns for validating inputs.
- **Tooltips/help text**: concise guidance shown to end-users at input time.
- **Error messages**: actionable feedback when validation fails.
- **SQL validations and mappings**: workflow-side validations and value casting used by stored procedures.
- **Standard formats**: shared formatting expectations (e.g., dates) reused across fields.

Each Laserfiche field validation is defined as a **triplet**:
- **Regex rule** — defines format/constraints
- **Tooltip/help text** — guides users to success
- **Error message** — clear, specific failure feedback

Some validations also have a corresponding **SQL-side rule** when:
- Values must be mapped/cast from user-friendly selections to system-friendly codes
- Business rules exceed regex-only complexity
- Referential checks (e.g., existence, uniqueness, status) are required


## Repository Structure

```
/regex/           # Reusable regex rules with descriptions and examples
/formats/         # Standard formats (dates, country codes, name casing, etc.)
/fields/          # Field-level definitions (regex + tooltip + error + examples)
/sql/             # SQL validations and mappings used in workflows & procedures
/docs/            # Additional docs, decision records, migration notes
README.md         # You are here
```

Recommended conventions for file naming:
- Place shared patterns in `/regex/` as `<topic>.md` (e.g., `name-capitalized.md`).
- Place standards in `/formats/` as `<format>.md` (e.g., `date-mmddyyyy.md`).
- Place field definitions in `/fields/<form-or-domain>/<field>.json`.
- Place SQL rules in `/sql/<domain-or-form>/<rule-name>.md`.


## Field Definition Format

Field-level rules are represented as JSON files to keep them diffable, typed, and machine-usable by tooling (future automation/validation export).

Example: `/fields/identity/missionary-id.json`
```json
{
  "id": "missionaryId",
  "displayName": "Missionary ID",
  "appliesToForms": ["Identity", "Onboarding"],
  "regex": "^[0-9]+$",
  "tooltip": "Enter the numeric Missionary ID (digits only).",
  "errorMessage": "Missionary ID must be digits only (no spaces or letters).",
  "examples": {
    "valid": ["12345", "987654321"],
    "invalid": ["12A45", " 12345 ", "12-345"]
  },
  "tags": ["id", "required"],
  "version": "1.0.0"
}
```


## SQL Validation/Mappings Format

Document SQL-side validations that complement or enforce business rules beyond regex. Include context, rule intent, T-SQL snippet(s), and example inputs/outputs.

Example: `/sql/identity/employee-type-mapping.md`
```md
# Employee Type Mapping

Maps user-friendly values to system codes used by downstream systems.

Display → Code:
- Appointee → ISE
- Spouse → ISES

Example T-SQL:
```sql
SELECT CASE @EmployeeTypeDisplay
  WHEN 'Appointee' THEN 'ISE'
  WHEN 'Spouse'   THEN 'ISES'
  ELSE NULL -- fail-safe for unexpected values
END AS EmployeeTypeCode;
```

Validation:
- Ensure result is not NULL; if NULL, raise a descriptive error for workflow.
```


## Standard Formats

- **Date (US)**: `MM/DD/YYYY`
  - Regex: `^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{4}$`
  - Tooltip: "Use MM/DD/YYYY (e.g., 03/21/2025)."
  - Error: "Enter a valid date in MM/DD/YYYY format."

- **Country Code**: `+NNNN` (1–4 digits)
  - Regex: `^\+\d{1,4}$`
  - Tooltip: "Enter a plus sign followed by 1–4 digits (e.g., +1, +504)."
  - Error: "Enter a country code like +1 or +504."

- **Capitalized Names** (words start upper-case; spaces allowed)
  - Regex: `^[A-Z][a-z]+(?: [A-Z][a-z]+)*$`
  - Tooltip: "Capitalize each word (e.g., John Doe)."
  - Error: "Use capitalized words (letters only)."

- **US SSN**: `NNN-NN-NNNN`
  - Regex: `^\d{3}-\d{2}-\d{4}$`
  - Tooltip: "Use ###-##-#### format."
  - Error: "Enter SSN as ###-##-####."

- **Canadian SIN**: `NNN NNN NNN`
  - Regex: `^\d{3} \d{3} \d{3}$`
  - Tooltip: "Use ### ### ### format."
  - Error: "Enter SIN as ### ### ###."


## Validation Rules Overview (Initial Catalog)

These examples outline the intended coverage. Define each as a field JSON and/or regex/format doc, then reference them from the corresponding Laserfiche forms and SQL workflows.

### GC Associate Secretary
- **Code**: numeric, positive digits only
  - Regex: `^[0-9]+$`
  - Tooltip: "Enter digits only."
  - Error: "Code must contain digits only."
- **Name**: capitalized
- **Missionary Type**: value must be one of the recognized types (e.g., `IDEA`)
- **Fail-safe**: SQL-side mapping returns NULL for unexpected values; workflow handles gracefully with clear error

### IPRS Specialist
- **Dropdown lookup**: `(Name, Missionary ID, Department)`
- **Code**: numeric, positive digits only
- **Name**: capitalized
- **Missionary Type**: includes `IDEA`
- **Fail-safe**: missing or unresolvable codes handled with descriptive errors

### Date Fields (use Standard Date format)
- Date call assigned to specialist → `MM/DD/YYYY`
- Completed call received → `MM/DD/YYYY`
- Date of birth → `MM/DD/YYYY`

### Country Fields
- Country / Country of citizenship → Country code format: `+NNNN`
- Supports Base, Home, Adopted, Family Adopted (field instances should reference the same country-code rule)

### Identity & Personal Info
- Missionary ID → digits only
- Employee type → mapping: `ISE / ISES` displayed as `Appointee / Spouse` (SQL mapping)
- Call status → enum: `APPLY, CURR, HOLD, INACTIVE, POSTAPP, PROSPECT, RETURNED, TRANSFER, UNSSG`
- Names (last, first, middle) → capitalized
- Birth city/state/country → capitalized
- Gender → `M/F` displayed as `Male/Female` (UI mapping)
- US SSN → SSN rule
- Canadian SIN → SIN rule
- eFile → must follow eFile-specific regex (define in `/regex/efile.md`)


## Usage Guidelines

- **Always use the triplet**: regex + tooltip + error message together for form fields.
- **Prefer front-end enforcement** in Laserfiche when possible; complement with SQL-side checks for business rules.
- **Use standard formats** from `/formats/` wherever applicable (dates, country codes, names).
- **Centralize mappings** (e.g., employee type, gender) in `/sql/` and reference them in workflows.
- **Implement fail-safes** in SQL to catch unexpected values and return clear, actionable error messages back to the workflow.


## Integration with Laserfiche Forms

1. Find the field definition in `/fields/` and copy the regex, tooltip, and error message.
2. Apply the regex to the Laserfiche input field validation.
3. Set the tooltip/help text and error message verbatim for consistency.
4. If the field requires mapping or referential checks, reference the corresponding `/sql/` doc in the workflow step.


## Contributing

1. **Add regex rules** in `/regex/` with:
   - Rule intent and description
   - Pattern with flags (if any)
   - Valid/invalid examples
   - Related fields

2. **Add field definitions** in `/fields/` as JSON triplets:
   - `regex`, `tooltip`, `errorMessage`, `examples`
   - Link to `/regex/` and `/formats/` entries if reused

3. **Add SQL validations/mappings** in `/sql/`:
   - Context, rule, mapping table (if any)
   - T-SQL example(s) and expected outputs
   - Failure behavior and error text returned to workflow

4. **Update this README** when introducing new categories, formats, or conventions.

5. **Versioning**:
   - Use semantic versions in field JSONs (`version` key)
   - Breaking changes require a new minor/major and migration notes in `/docs/`


## Template: New Field JSON

Copy this template into `/fields/<domain>/<field>.json`.
```json
{
  "id": "<machineId>",
  "displayName": "<Display Name>",
  "appliesToForms": ["<Form Name 1>", "<Form Name 2>"] ,
  "regex": "<pattern>",
  "tooltip": "<how to fill>",
  "errorMessage": "<what went wrong>",
  "examples": {
    "valid": ["<example1>", "<example2>"],
    "invalid": ["<bad1>", "<bad2>"]
  },
  "tags": ["<tag1>", "<tag2>"],
  "version": "1.0.0"
}
```


## Roadmap

- Populate `/regex/` with the core patterns listed above
- Define `/formats/` for dates, country codes, capitalization
- Create `/fields/` JSON entries for high-traffic forms first (Identity, IPRS)
- Document existing workflow SQL mappings in `/sql/`


## License

Internal use. If this repository later needs a formal OSS license, add it here.
