# Fields

This directory contains field-level validation definitions for Laserfiche Forms.
Each field is represented as a JSON document that encapsulates the full
validation “triplet” used in the UI plus any metadata needed for workflows
and downstream systems.

## Goals

- Provide a single, reusable definition per field
- Keep regex, tooltip/help text, and error message in sync
- Enable consistent integration between Forms and SQL workflows
- Support versioning, localization, and change tracking

## Location and naming

- Place files under `fields/<domain>/<field>.json`
- Use a short, machine-friendly file name for `<field>` (kebab-case or
  lowerCamelCase), e.g. `missionary-id.json`, `date-of-birth.json`
- Group related fields by `<domain>` (e.g., `identity/`, `iprs/`)

## JSON contract (required keys)

Every field JSON must include the following keys:

- `id` (string): Machine identifier for the field (stable across versions)
- `displayName` (string): Human-readable field name
- `appliesToForms` (string[]): List of Laserfiche forms using this field
- `regex` (string): Canonical regex (PCRE-style) to validate input
- `tooltip` (string | object): End-user help text; may be localized
- `errorMessage` (string | object): Failure feedback; may be localized
- `examples` (object): Example inputs
  - `valid` (string[]): Inputs that should pass
  - `invalid` (string[]): Inputs that should fail
- `version` (string): Semantic version of this field definition

## Optional keys (recommended when applicable)

- `tags` (string[]): Simple labels, e.g., `required`, `pii`, `id`
- `required` (boolean): Whether the field is mandatory in the UI
- `minLength` / `maxLength` (number): Length constraints (UI hints)
- `flags` (string): Regex flags if applicable (e.g., `i`)
- `formatRef` (string): Link to a standard format in `/formats/`
- `regexRef` (string): Link to a shared pattern in `/regex/`
- `allowedValues` (string[]): Enumerated set when applicable
- `displayToCodeMap` (object): UI display → system code mapping
- `sqlValidationRef` (string): Path to a doc in `/sql/` when SQL-side rules apply
- `dependsOn` (string[]): Other fields this field logically depends on
- `deprecated` (boolean): True if replaced; include replacement info in `notes`
- `notes` (string): Anything non-obvious that future maintainers should know

## Localization shape

For `tooltip` and `errorMessage`, you may either provide a single string
or a map of locale → string. Example:

```json
{
  "tooltip": {
    "en-US": "Enter digits only.",
    "es-ES": "Ingrese solo dígitos."
  },
  "errorMessage": {
    "en-US": "Must contain digits only.",
    "es-ES": "Debe contener solo dígitos."
  }
}
```

## Example: Missionary ID (digits only)

```json
{
  "id": "missionaryId",
  "displayName": "Missionary ID",
  "appliesToForms": ["Identity", "Onboarding"],
  "regex": "^[0-9]+$",
  "tooltip": "Enter the numeric Missionary ID (digits only).",
  "errorMessage": "Missionary ID must be digits only (no spaces or letters).",
  "examples": {
    "valid": ["12345", "987654321"],
    "invalid": ["12A45", " 12345 ", "12-345"]
  },
  "tags": ["id", "required"],
  "version": "1.0.0"
}
```

## Example: Date of Birth (formatRef to standard date)

References the standard US date format in `/formats/date-mmddyyyy.md`.

```json
{
  "id": "dateOfBirth",
  "displayName": "Date of Birth",
  "appliesToForms": ["Identity"],
  "regex": "^(0[1-9]|1[0-2])\\/(0[1-9]|[12][0-9]|3[01])\\/\\d{4}$",
  "formatRef": "/formats/date-mmddyyyy.md",
  "tooltip": "Use MM/DD/YYYY (e.g., 03/21/2025).",
  "errorMessage": "Enter a valid date in MM/DD/YYYY format.",
  "examples": {
    "valid": ["01/01/1990", "12/31/2025"],
    "invalid": ["1/1/1990", "13/10/2020", "02/30/2020"]
  },
  "tags": ["date"],
  "version": "1.0.0"
}
```

## Example: Employee Type (enum with mapping)

Includes display → code mapping used in workflows (documented in `/sql/`).

```json
{
  "id": "employeeType",
  "displayName": "Employee Type",
  "appliesToForms": ["Identity"],
  "allowedValues": ["Appointee", "Spouse"],
  "displayToCodeMap": {
    "Appointee": "ISE",
    "Spouse": "ISES"
  },
  "regex": "^(Appointee|Spouse)$",
  "sqlValidationRef": "/sql/identity/employee-type-mapping.md",
  "tooltip": "Select Appointee or Spouse.",
  "errorMessage": "Employee Type must be Appointee or Spouse.",
  "examples": {
    "valid": ["Appointee", "Spouse"],
    "invalid": ["appointee", "Partner", ""]
  },
  "tags": ["enum", "mapping"],
  "version": "1.0.0"
}
```

## Versioning and deprecation

- Use semantic versions in `version` (e.g., `1.2.0`)
- Increment minor for non-breaking changes (expanded examples, clarified tooltip)
- Increment major for breaking changes (regex tightened, enum changed)
- When deprecating, set `deprecated: true` and provide guidance in `notes`

## Integration steps (Laserfiche Forms)

1. Copy `regex`, `tooltip`, and `errorMessage` into the form field.
2. Honor `required`, `minLength`, `maxLength` when setting field constraints.
3. If `formatRef`/`regexRef` exists, ensure consistent masking/formatting.
4. If `displayToCodeMap` or `sqlValidationRef` exists, integrate the mapping
   and validation logic in the workflow/stored procedure.

## Review checklist

- Does the field include regex, tooltip, error message, and examples?
- Are examples representative and test edge cases?
- Are formats and shared regexes referenced instead of duplicated?
- If enum/mapping is present, is it aligned with `/sql/` docs?
- Is `version` updated and change impact considered?
